# BEGIN LSCACHE
## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block! ##
<IfModule LiteSpeed>
	RewriteEngine on
	CacheLookup on
	RewriteRule .* - [E=Cache-Control:no-autoflush]
	RewriteRule litespeed/debug/.*\.log$ - [F,L]
	RewriteRule \.litespeed_conf\.dat - [F,L]
	
### marker ASYNC start ###
	RewriteCond %{REQUEST_URI} /wp-admin/admin-ajax\.php
	RewriteCond %{QUERY_STRING} action=async_litespeed
	RewriteRule .* - [E=noabort:1]
### marker ASYNC end ###
	
### marker MOBILE start ###
	RewriteCond %{HTTP_USER_AGENT} Mobile|Android|Silk/|Kindle|BlackBerry|Opera\ Mini|Opera\ Mobi [NC]
	RewriteRule .* - [E=Cache-Control:vary=%{ENV:LSCACHE_VARY_VALUE}+ismobile]
### marker MOBILE end ###
	
### marker CACHE RESOURCE start ###
	RewriteRule wp-content/.*/[^/]*(responsive|css|js|dynamic|loader|fonts)\.php - [E=cache-control:max-age=3600]
### marker CACHE RESOURCE end ###
	
### marker WEBP start ###
	RewriteCond %{HTTP_ACCEPT} "image/webp"
	RewriteRule .* - [E=Cache-Control:vary=%{ENV:LSCACHE_VARY_VALUE}+webp]
	RewriteCond %{HTTP_USER_AGENT} iPhone.*Version/(\d{2}).*Safari
	RewriteCond %1 >13
	RewriteRule .* - [E=Cache-Control:vary=%{ENV:LSCACHE_VARY_VALUE}+webp]
	RewriteCond %{HTTP_USER_AGENT} Firefox/([0-9]+)
	RewriteCond %1 >=65
	RewriteRule .* - [E=Cache-Control:vary=%{ENV:LSCACHE_VARY_VALUE}+webp]
### marker WEBP end ###
	
### marker DROPQS start ###
	CacheKeyModify -qs:fbclid
	CacheKeyModify -qs:gclid
	CacheKeyModify -qs:utm*
	CacheKeyModify -qs:_ga
### marker DROPQS end ###
</IfModule>
## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block! ##
# END LSCACHE

# BEGIN NON_LSCACHE
## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block! ##
### marker BROWSER CACHE start ###
<IfModule mod_expires.c>
	ExpiresActive on
	ExpiresByType application/pdf A31557600
	ExpiresByType image/x-icon A31557600
	ExpiresByType image/vnd.microsoft.icon A31557600
	ExpiresByType image/svg+xml A31557600
	ExpiresByType image/jpg A31557600
	ExpiresByType image/jpeg A31557600
	ExpiresByType image/png A31557600
	ExpiresByType image/gif A31557600
	ExpiresByType image/webp A31557600
	ExpiresByType image/avif A31557600
	ExpiresByType video/ogg A31557600
	ExpiresByType audio/ogg A31557600
	ExpiresByType video/mp4 A31557600
	ExpiresByType video/webm A31557600
	ExpiresByType text/css A31557600
	ExpiresByType text/javascript A31557600
	ExpiresByType application/javascript A31557600
	ExpiresByType application/x-javascript A31557600
	ExpiresByType application/x-font-ttf A31557600
	ExpiresByType application/x-font-woff A31557600
	ExpiresByType application/font-woff A31557600
	ExpiresByType application/font-woff2 A31557600
	ExpiresByType application/vnd.ms-fontobject A31557600
	ExpiresByType font/ttf A31557600
	ExpiresByType font/otf A31557600
	ExpiresByType font/woff A31557600
	ExpiresByType font/woff2 A31557600
</IfModule>
### marker BROWSER CACHE end ###
## LITESPEED WP CACHE PLUGIN - Do not edit the contents of this block! ##
# END NON_LSCACHE

# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>
# END WordPress

# BEGIN CWVPSB Rules
# (empty by plugin design)
# END CWVPSB Rules

# BEGIN Headers Security Advanced & HSTS WP 5.0.43
<IfModule mod_headers.c>
Header set Access-Control-Allow-Methods "GET,POST"
Header set Access-Control-Allow-Headers "Content-Type, Authorization"
Header set Content-Security-Policy "upgrade-insecure-requests;"
Header set Cross-Origin-Embedder-Policy "unsafe-none; report-to='default'"
Header set Cross-Origin-Embedder-Policy-Report-Only "unsafe-none; report-to='default'"
Header set Cross-Origin-Opener-Policy "unsafe-none"
Header set Cross-Origin-Opener-Policy-Report-Only "unsafe-none; report-to='default'"
Header set Cross-Origin-Resource-Policy "cross-origin"
Header set Permissions-Policy "accelerometer=(), autoplay=(), camera=(), cross-origin-isolated=(), display-capture=(self), encrypted-media=(), fullscreen=*, geolocation=(self), gyroscope=(), keyboard-map=(), magnetometer=(), microphone=(), midi=(), payment=*, picture-in-picture=*, publickey-credentials-get=(), screen-wake-lock=(), sync-xhr=*, usb=(), xr-spatial-tracking=(), gamepad=(), serial=()"
Header set Referrer-Policy "strict-origin-when-cross-origin"
Header set Strict-Transport-Security "max-age=63072000"
Header set X-Content-Security-Policy "default-src 'self'; img-src *; media-src * data:;"
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "SAMEORIGIN"
Header set X-Permitted-Cross-Domain-Policies "none"
</IfModule>
# END Headers Security Advanced & HSTS WP

# BEGIN Enhanced Security Rules (Merged from Optimized Config)
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /

# Block XML-RPC if not needed
<Files xmlrpc.php>
 Order Deny,Allow
 Deny from all
</Files>

# Deny access to sensitive files
<Files install.php>
Order allow,deny
Deny from all
</Files>
<Files wp-config.php>
Order allow,deny
Deny from all
</Files>
<Files readme.html>
Order allow,deny
Deny from all
Satisfy all
</Files>
<Files liesmich.html>
Order allow,deny
Deny from all
Satisfy all
</Files>
<Files error_log>
Order allow,deny
Deny from all
</Files>
<FilesMatch "(\.htaccess|\.htpasswd)">
  Order deny,allow
  Deny from all
</FilesMatch>

# Block WordPress Author scans
RewriteCond %{REQUEST_URI} ^/wp-json/wp/v2/users [OR]
RewriteCond %{QUERY_STRING} (author=\d+) [NC]
RewriteRule ^ - [NC,F,L]
</IfModule>
# END Enhanced Security Rules

# BEGIN 8G Firewall
# Full 8G Firewall rules below
# Source: https://perishablepress.com/8g-firewall/
# Version: 1.3 â€” 2024
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /

# 8G Firewall: Core malicious patterns
RewriteCond %{QUERY_STRING} (%0A|%0D|%27|%3C|%3E|%00) [NC,OR]
RewriteCond %{QUERY_STRING} (eval\(|base64_decode\(|union.*select|localhost|loopback) [NC,OR]
RewriteCond %{QUERY_STRING} (cmd=|exec|concat|insert|cast|set\s+password|md5\(|
root_path|chmod\(|chown\(|wget\(|curl\(|phpinfo\(|fsockopen\(|pfsockopen\() [NC,OR]
RewriteCond %{QUERY_STRING} (\.\./|\.\.\\|etc/passwd|self/environ|input_file|mosconfig|scanner|proc/self) [NC]
RewriteRule .* - [F]

# 8G Firewall: Request URI patterns
RewriteCond %{REQUEST_URI} (\.\.\/|\.\.\\|global\.asa|default\.ida|root\.exe|cmd\.exe|admin\.pl|perl\.pl|formmail\.pl|mailform\.pl|mail\.pl|nobody\.pl|shell\.pl|sendmail\.pl|config\.inc|myadmin|phpmyadmin|setup\.php|phpinfo\.php) [NC]
RewriteRule .* - [F]

# 8G Firewall: User Agent restrictions
RewriteCond %{HTTP_USER_AGENT} (libwww-perl|curl|wget|python|nikto|scan|nmap|masscan|dirbuster|fimap|sqlmap|netsparker|acunetix) [NC]
RewriteRule .* - [F]

# 8G Firewall: Referrer spam
RewriteCond %{HTTP_REFERER} (viagra|cialis|pharmacy|payday|porn|casino|loan|free-money|bonus) [NC]
RewriteRule .* - [F]

# 8G Firewall: Bad request methods
RewriteCond %{REQUEST_METHOD} ^(TRACE|DELETE|TRACK|DEBUG) [NC]
RewriteRule .* - [F]
</IfModule>
# END 8G Firewall
